local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local Library = {}

-- Hệ thống màu sắc hỗ trợ nhanh
local Colors = {
    White = Color3.fromRGB(255, 255, 255),
    Black = Color3.fromRGB(0, 0, 0),
    Yellow = Color3.fromRGB(255, 220, 100),
    Gray = Color3.fromRGB(180, 180, 180)
}

local LibTheme = {
    Main = Color3.fromRGB(15, 15, 20),
    Sidebar = Color3.fromRGB(12, 12, 15),
    Accent = Colors.Yellow,
    ItemBG = Color3.fromRGB(22, 22, 28),
    Border = Color3.fromRGB(45, 45, 55)
}

function Library:MakeWindow(Config)
    local Window = {}
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "BananaCat_Premium"
    ScreenGui.Parent = (getgenv and CoreGui) or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 680, 0, 420)
    MainFrame.Position = UDim2.new(0.5, -340, 0.5, -210)
    MainFrame.BackgroundColor3 = LibTheme.Main
    MainFrame.Parent = ScreenGui
    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 5)

    local ContentContainer = Instance.new("Frame")
    ContentContainer.Size = UDim2.new(1, -225, 1, -50)
    ContentContainer.Position = UDim2.new(0, 220, 0, 45)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Parent = MainFrame

    function Window:MakeTab(TabConfig)
        local Tab = {}
        local TabPage = Instance.new("ScrollingFrame")
        TabPage.Size = UDim2.new(1, 0, 1, 0)
        TabPage.BackgroundTransparency = 1
        TabPage.ScrollBarThickness = 2
        TabPage.Visible = true -- Tạm thời để true để test
        TabPage.Parent = ContentContainer
        Instance.new("UIListLayout", TabPage).Padding = UDim.new(0, 8)

        -- HÀM THÊM TOGGLE
        function Tab:AddToggle(TogConfig)
            local Name = TogConfig.Name or "Toggle"
            local Default = TogConfig.Default or false
            local Callback = TogConfig.Callback or function() end
            local TColor = Colors[TogConfig.TextColor] or Colors.White -- Check màu từ lệnh TextColor
            
            local Toggled = Default

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, -15, 0, 45)
            Frame.BackgroundColor3 = LibTheme.ItemBG
            Frame.Parent = TabPage
            Instance.new("UICorner", Frame)

            local Label = Instance.new("TextLabel")
            Label.Text = Name
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.Position = UDim2.new(0, 15, 0, 0)
            Label.TextColor3 = TColor -- Áp dụng màu tùy chỉnh
            Label.Font = Enum.Font.GothamBold
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Parent = Frame

            local ToggleBG = Instance.new("TextButton")
            ToggleBG.Size = UDim2.new(0, 40, 0, 20)
            ToggleBG.Position = UDim2.new(1, -50, 0.5, -10)
            ToggleBG.BackgroundColor3 = Toggled and LibTheme.Accent or Color3.fromRGB(50, 50, 50)
            ToggleBG.Text = ""
            ToggleBG.Parent = Frame
            Instance.new("UICorner", ToggleBG).CornerRadius = UDim.new(1, 0)

            local Dot = Instance.new("Frame")
            Dot.Size = UDim2.new(0, 16, 0, 16)
            Dot.Position = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
            Dot.BackgroundColor3 = Colors.White
            Dot.Parent = ToggleBG
            Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)

            ToggleBG.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                local targetPos = Toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8)
                local targetColor = Toggled and LibTheme.Accent or Color3.fromRGB(50, 50, 50)
                
                TweenService:Create(Dot, TweenInfo.new(0.2), {Position = targetPos}):Play()
                TweenService:Create(ToggleBG, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
                
                Callback(Toggled)
            end)
        end

        return Tab
    end
    return Window
end

return Library
