local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")

local Library = {}

-- Hệ thống màu sắc
local Colors = {
    White = Color3.fromRGB(255, 255, 255),
    Black = Color3.fromRGB(0, 0, 0),
    Yellow = Color3.fromRGB(255, 220, 100),
    Gray = Color3.fromRGB(180, 180, 180)
}

local LibTheme = {
    Main = Color3.fromRGB(15, 15, 20),
    Sidebar = Color3.fromRGB(12, 12, 15),
    Accent = Colors.Yellow,
    ItemBG = Color3.fromRGB(25, 25, 30),
    Border = Color3.fromRGB(45, 45, 55)
}

function Library:MakeWindow(Config)
    local Window = {}
    local TitleText = Config.Title or "Banana Cat Hub"
    local SubTitleText = Config.SubTitle or "Blox Fruit"

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "BananaCat_Premium"
    ScreenGui.Parent = (getgenv and CoreGui) or game:GetService("Players").LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local MainFrame = Instance.new("Frame")
    MainFrame.Size = UDim2.new(0, 680, 0, 420)
    MainFrame.Position = UDim2.new(0.5, -340, 0.5, -210)
    MainFrame.BackgroundColor3 = LibTheme.Main
    MainFrame.Parent = ScreenGui
    Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0, 6)

    -- Header
    local Header = Instance.new("Frame")
    Header.Size = UDim2.new(1, 0, 0, 40)
    Header.BackgroundTransparency = 1
    Header.Parent = MainFrame

    local TitleLabel = Instance.new("TextLabel")
    TitleLabel.Text = TitleText .. " - " .. SubTitleText
    TitleLabel.Font = Enum.Font.GothamBold
    TitleLabel.TextSize = 16
    TitleLabel.TextColor3 = LibTheme.Accent
    TitleLabel.Size = UDim2.new(1, 0, 1, 0)
    TitleLabel.BackgroundTransparency = 1
    TitleLabel.Parent = Header

    local ContentContainer = Instance.new("Frame")
    ContentContainer.Size = UDim2.new(1, -225, 1, -50)
    ContentContainer.Position = UDim2.new(0, 215, 0, 45)
    ContentContainer.BackgroundTransparency = 1
    ContentContainer.Parent = MainFrame

    function Window:MakeTab(TabConfig)
        local Tab = {}
        local Page = Instance.new("ScrollingFrame")
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 2
        Page.Parent = ContentContainer
        Instance.new("UIListLayout", Page).Padding = UDim.new(0, 8)

        -- 1. ADD TOGGLE
        function Tab:AddToggle(TogConfig)
            local Toggled = TogConfig.Default or false
            local TextCol = Colors[TogConfig.TextColor] or Colors.White

            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, -10, 0, 45)
            Frame.BackgroundColor3 = LibTheme.ItemBG
            Frame.Parent = Page
            Instance.new("UICorner", Frame)

            local Label = Instance.new("TextLabel")
            Label.Text = TogConfig.Name
            Label.Size = UDim2.new(1, -60, 1, 0)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.TextColor3 = TextCol
            Label.Font = Enum.Font.GothamBold
            Label.TextSize = 13
            Label.BackgroundTransparency = 1
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.Parent = Frame

            local Switch = Instance.new("TextButton")
            Switch.Size = UDim2.new(0, 36, 0, 18)
            Switch.Position = UDim2.new(1, -45, 0.5, -9)
            Switch.BackgroundColor3 = Toggled and LibTheme.Accent or Color3.fromRGB(50, 50, 55)
            Switch.Text = ""
            Switch.Parent = Frame
            Instance.new("UICorner", Switch).CornerRadius = UDim.new(1, 0)

            local Dot = Instance.new("Frame")
            Dot.Size = UDim2.new(0, 14, 0, 14)
            Dot.Position = Toggled and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)
            Dot.BackgroundColor3 = Colors.White
            Dot.Parent = Switch
            Instance.new("UICorner", Dot).CornerRadius = UDim.new(1, 0)

            Switch.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Toggled and LibTheme.Accent or Color3.fromRGB(50, 50, 55)}):Play()
                TweenService:Create(Dot, TweenInfo.new(0.2), {Position = Toggled and UDim2.new(1, -16, 0.5, -7) or UDim2.new(0, 2, 0.5, -7)}):Play()
                TogConfig.Callback(Toggled)
            end)
        end

        -- 2. ADD DROPDOWN
        function Tab:AddDropdown(DropConfig)
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, -10, 0, 45)
            Frame.BackgroundColor3 = LibTheme.ItemBG
            Frame.ClipsDescendants = true
            Frame.Parent = Page
            Instance.new("UICorner", Frame)

            local Label = Instance.new("TextLabel")
            Label.Text = DropConfig.Name .. ": " .. (DropConfig.Default or "None")
            Label.Size = UDim2.new(1, 0, 0, 45)
            Label.Position = UDim2.new(0, 12, 0, 0)
            Label.TextColor3 = Colors[DropConfig.TextColor] or Colors.White
            Label.Font = Enum.Font.GothamBold
            Label.TextSize = 13
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Parent = Frame

            local OpenBtn = Instance.new("TextButton")
            OpenBtn.Size = UDim2.new(1, 0, 0, 45)
            OpenBtn.BackgroundTransparency = 1
            OpenBtn.Text = ""
            OpenBtn.Parent = Frame

            local DropContainer = Instance.new("Frame")
            DropContainer.Position = UDim2.new(0, 0, 0, 45)
            DropContainer.Size = UDim2.new(1, 0, 0, #DropConfig.Options * 30)
            DropContainer.BackgroundTransparency = 1
            DropContainer.Parent = Frame
            Instance.new("UIListLayout", DropContainer)

            local Opened = false
            OpenBtn.MouseButton1Click:Connect(function()
                Opened = not Opened
                TweenService:Create(Frame, TweenInfo.new(0.3), {Size = Opened and UDim2.new(1, -10, 0, 45 + (#DropConfig.Options * 30)) or UDim2.new(1, -10, 0, 45)}):Play()
            end)

            for _, opt in pairs(DropConfig.Options) do
                local OptBtn = Instance.new("TextButton")
                OptBtn.Size = UDim2.new(1, 0, 0, 30)
                OptBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
                OptBtn.Text = opt
                OptBtn.Font = Enum.Font.Gotham
                OptBtn.TextColor3 = Colors.Gray
                OptBtn.TextSize = 12
                OptBtn.Parent = DropContainer
                
                OptBtn.MouseButton1Click:Connect(function()
                    Label.Text = DropConfig.Name .. ": " .. opt
                    Opened = false
                    TweenService:Create(Frame, TweenInfo.new(0.3), {Size = UDim2.new(1, -10, 0, 45)}):Play()
                    DropConfig.Callback(opt)
                end)
            end
        end

        -- 3. ADD SLIDER
        function Tab:AddSlider(SliConfig)
            local Frame = Instance.new("Frame")
            Frame.Size = UDim2.new(1, -10, 0, 55)
            Frame.BackgroundColor3 = LibTheme.ItemBG
            Frame.Parent = Page
            Instance.new("UICorner", Frame)

            local Label = Instance.new("TextLabel")
            Label.Text = SliConfig.Name
            Label.Size = UDim2.new(1, 0, 0, 30)
            Label.Position = UDim2.new(0, 12, 0, 5)
            Label.TextColor3 = Colors[SliConfig.TextColor] or Colors.White
            Label.Font = Enum.Font.GothamBold
            Label.TextSize = 13
            Label.TextXAlignment = Enum.TextXAlignment.Left
            Label.BackgroundTransparency = 1
            Label.Parent = Frame

            local ValueLabel = Instance.new("TextLabel")
            ValueLabel.Text = tostring(SliConfig.Default or SliConfig.Min)
            ValueLabel.Size = UDim2.new(0, 50, 0, 30)
            ValueLabel.Position = UDim2.new(1, -60, 0, 5)
            ValueLabel.TextColor3 = LibTheme.Accent
            ValueLabel.Font = Enum.Font.GothamBold
            ValueLabel.TextSize = 13
            ValueLabel.BackgroundTransparency = 1
            ValueLabel.Parent = Frame

            local SliderBar = Instance.new("Frame")
            SliderBar.Size = UDim2.new(1, -24, 0, 6)
            SliderBar.Position = UDim2.new(0, 12, 0, 40)
            SliderBar.BackgroundColor3 = Color3.fromRGB(50, 50, 55)
            SliderBar.Parent = Frame
            Instance.new("UICorner", SliderBar)

            local SliderFill = Instance.new("Frame")
            SliderFill.Size = UDim2.new((SliConfig.Default - SliConfig.Min)/(SliConfig.Max - SliConfig.Min), 0, 1, 0)
            SliderFill.BackgroundColor3 = LibTheme.Accent
            SliderFill.Parent = SliderBar
            Instance.new("UICorner", SliderFill)

            local function UpdateSlider()
                local MousePos = UserInputService:GetMouseLocation().X
                local BarPos = SliderBar.AbsolutePosition.X
                local BarSize = SliderBar.AbsoluteSize.X
                local Percent = math.clamp((MousePos - BarPos) / BarSize, 0, 1)
                local Value = math.floor(SliConfig.Min + (SliConfig.Max - SliConfig.Min) * Percent)
                
                SliderFill.Size = UDim2.new(Percent, 0, 1, 0)
                ValueLabel.Text = tostring(Value)
                SliConfig.Callback(Value)
            end

            local Dragging = false
            Frame.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = true UpdateSlider() end
            end)
            UserInputService.InputChanged:Connect(function(input)
                if Dragging and input.UserInputType == Enum.UserInputType.MouseMovement then UpdateSlider() end
            end)
            UserInputService.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then Dragging = false end
            end)
        end

        return Tab
    end
    return Window
end

return Library
